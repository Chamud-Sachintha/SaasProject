!function(e){"use strict";var t={mapHolder:"",mapOptions:[],mapElement:"",map:{},markers:{},circleMap:{},init:function(e,t){this.mapHolder=e,"object"==typeof google&&void 0!==this.mapHolder&&""!=typeof this.mapHolder&&this.initMap(this.mapHolder,t)},getMapSettings:function(){return{styles:qodefMapsVariables.global.mapStyle,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:qodefMapsVariables.global.mapScrollable,draggable:qodefMapsVariables.global.mapDraggable,streetViewControl:qodefMapsVariables.global.streetViewControl,zoomControl:qodefMapsVariables.global.zoomControl,zoom:parseInt(qodefMapsVariables.global.mapZoom,10),mapTypeControl:qodefMapsVariables.global.mapTypeControl,fullscreenControl:qodefMapsVariables.global.fullscreenControl}},getMapOptions:function(t,o){var a={uniqueId:"",holderId:"",mapHeight:0,addresses:[],addressesLatLng:[],pin:"",selectorIsID:!1,multipleTrigger:!1,geolocation:!1};return(a=e.extend(a,o)).selectorIsID?(a.uniqueId=t[0].id,a.holderId=t[0].id):void 0!==t.data("unique-id")&&!1!==t.data("unique-id")&&(a.uniqueId=t.data("unique-id"),a.holderId="qodef-map-id--"+t.data("unique-id")),void 0!==t.data("height")&&!1!==t.data("height")&&(a.mapHeight=parseInt(t.data("height"),10)),void 0!==qodefMapsVariables.multiple.addresses&&""!==qodefMapsVariables.multiple.addresses?a.addresses=qodefMapsVariables.multiple.addresses:void 0!==t.data("addresses")&&!1!==t.data("addresses")&&(a.addresses=t.data("addresses")),void 0!==t.data("pin")&&!1!==t.data("pin")&&(a.pin=t.data("pin")),a},initMap:function(e,t){this.mapOptions=this.getMapOptions(e,t),this.mapElement=document.getElementById(this.mapOptions.holderId),this.map=new google.maps.Map(this.mapElement,this.getMapSettings()),this.triggerGeolocation(),this.setAddress(),this.setMapHeight()},triggerGeolocation:function(){navigator.geolocation&&this.mapOptions.geolocation&&this.centerMapToGeolocationAddress()},setAddress:function(){for(var t=0;t<this.mapOptions.addresses.length;t++){var o=this.mapOptions.addresses[t];if(""===o)return;if(this.mapOptions.multipleTrigger){var a=o.location;null!=a&&""!==a.latitude&&""!==a.longitude&&this.mapOptions.addressesLatLng.push(e.extend(a,o))}else this.setSingleAddress(o)}this.mapOptions.multipleTrigger&&(this.centerMapMultipleAddresses(this.map,this.mapOptions),this.addMultipleMarkers())},setSingleAddress:function(e){var o=new google.maps.InfoWindow({content:'<div id="content"><div id="siteNotice"></div><div id="bodyContent"><p>'+e+"</p></div></div>"}),a=new google.maps.Geocoder;if("object"==typeof a){var i=this.map,s=this.mapOptions;a.geocode({address:e},(function(a,n){if(n===google.maps.GeocoderStatus.OK&&"object"==typeof a){var r=new google.maps.Marker({map:i,position:a[0].geometry.location,icon:s.pin,title:e.store_title});google.maps.event.addListener(r,"click",(function(){o.open(i,r)}));var d={address:a[0].formatted_address,latitude:a[0].geometry.location.lat(),longitude:a[0].geometry.location.lng()};s.addressesLatLng.push(d),t.centerMapAddress(i,s,a)}}))}},setMapHeight:function(){var e=this.mapOptions;e.mapHeight>0&&""!==this.mapElement&&(this.mapElement.style.height=e.mapHeight+"px")},centerMapAddress:function(e,o,a){1===o.addresses.length?e.setCenter(a[0].geometry.location):this.centerMapMultipleAddresses(e,o),google.maps.event.addDomListener(window,"resize",(function(){t.centerMapAddress(e,o,a)}))},centerMapMultipleAddresses:function(e,t){var o=new google.maps.LatLngBounds,a=t.addressesLatLng;if(t.multipleTrigger&&1===a.length)e.setCenter({lat:parseFloat(a[0].latitude),lng:parseFloat(a[0].longitude)});else if("object"==typeof o&&a.length){for(var i=0;i<a.length;i++)o.extend({lat:parseFloat(a[i].latitude),lng:parseFloat(a[i].longitude)});e.fitBounds(o)}},centerMapToGeolocationAddress:function(e,t,o,a){if(navigator.geolocation){var i=this.map;e&&o.addClass("fa-spinner fa-spin"),navigator.geolocation.getCurrentPosition((function(a){var s={lat:a.coords.latitude,lng:a.coords.longitude};if(e){var n=new google.maps.Geocoder,r="",d="";n.geocode({latLng:s},(function(e,a){if(a===google.maps.GeocoderStatus.OK&&"object"==typeof e){for(var i=e,n=0;n<=i.length;n++){var l=i[n];if("object"==typeof l&&"locality"===l.types[0]){var p=l.address_components;r=p[0].long_name;for(var g=0;g<=p.length;g++)"object"==typeof p[g]&&"country"===p[g].types[0]&&(d=r+","+p[g].long_name)}}"string"==typeof r&&(o.removeClass("fa-spinner fa-spin"),"string"==typeof d?t.val(d):t.val(r),window.qodefGeoLocation.showRangeSlider(s,!0),qodef.body.trigger("deon_core_trigger_after_autocomplete_places",[t]))}}))}else i.setCenter(s)}))}},centerMapToForwardAddress:function(e){if("string"==typeof e&&"object"==typeof google){var t=this.map,o=this.getMapSettings();(new google.maps.Geocoder).geocode({address:e},(function(e,a){a===google.maps.GeocoderStatus.OK&&"object"==typeof e[0]&&(t.setZoom(o.zoom),t.setCenter(e[0].geometry.location))}))}},addMultipleMarkers:function(){for(var e=[],t=this.mapOptions.addressesLatLng,o=0;o<t.length;o++){var a={lat:parseFloat(t[o].latitude),lng:parseFloat(t[o].longitude)},i={title:t[o].title,itemId:t[o].itemId,address:t[o].address,featuredImage:t[o].featuredImage,itemUrl:t[o].itemUrl,latLng:a},s=new window.qodefCustomMarker({position:a,map:this.map,templateData:i,markerPin:t[o].markerPin});e.push(s)}this.markers=e,this.initMarkerClusters(),this.initMarkerInfo()},initMarkerClusters:function(){new MarkerClusterer(this.map,this.markers,{minimumClusterSize:2,maxZoom:12,styles:[{width:50,height:60,url:"",textSize:12}]})},initMarkerInfo:function(){var t=this.map;e(document).off("click",".qodef-map-marker").on("click",".qodef-map-marker",(function(){var o=e(this),a=e(".qodef-map-marker-holder"),i=e(".qodef-info-window"),s=o.parent(".qodef-map-marker-holder"),n=s.data("latlng"),r=o.siblings(".qodef-info-window");if(s.hasClass("qodef-active qodef-map-active"))s.removeClass("qodef-active qodef-map-active"),r.fadeOut(0);else if(a.removeClass("qodef-active qodef-map-active"),i.fadeOut(0),s.addClass("qodef-active qodef-map-active"),r.fadeIn(300),n.length&&void 0!==n){var d=n.replace("(","").replace(")","").split(",",2);t.panTo(new google.maps.LatLng(parseFloat(d[0]),parseFloat(d[1])))}}))},setGeoLocationRadius:function(t,o,a){if("object"==typeof t&&"object"==typeof google){var i=this.map,s=this.markers;a&&this.circleMap.setMap(null),this.circleMap=new google.maps.Circle({map:i,center:t,radius:1e3*parseInt(o,10),strokeWeight:0,fillColor:"#fc475f",fillOpacity:.15});var n=this.circleMap,r=[];e.each(s,(function(e,t){n.getBounds().contains(t.latlng)&&r.push(t.templateData.itemId)})),window.qodefGeoLocation.disableItemsOutOfRange(r)}},createAutocompletePlaces:function(t){if("object"==typeof google&&"object"==typeof google.maps.places){new google.maps.places.Autocomplete(t,{types:["(cities)"]}).addListener("place_changed",(function(){e(t).next().show(),window.qodefGeoLocation.reset(),qodef.body.trigger("deon_core_trigger_after_autocomplete_places",[t])}))}}};window.qodefGoogleMap=t;var o={holder:"",radius:"",slider:"",init:function(e=""){this.holder=e,this.holder.length&&(this.radius=this.holder.find(".qodef-places-geo-radius"),this.slider=document.getElementById("qodef-range-slider-id"),this.radius.length&&null!==this.slider&&this.createSlider())},createSlider:function(){noUiSlider.create(this.slider,{connect:[!0,!1],start:0,step:1,tooltips:!0,format:{from:function(e){return parseInt(e)},to:function(e){return parseInt(e)}},range:{min:0,max:100}}),this.updateMapRadius()},updateMapRadius:function(){var e=0;this.slider.noUiSlider.on("set",(function(t){var a=o.radius.data("geo-location");"object"==typeof a&&(window.qodefGoogleMap.setGeoLocationRadius(a,t,e>0),e++)}))},reset:function(){null!==this.slider&&this.radius.length&&this.radius.is(":visible")&&(this.setRadiusVisibility("",!1),this.slider.noUiSlider.reset())},showRangeSlider:function(e,t){this.radius.length&&this.setRadiusVisibility(e,t)},setRadiusVisibility:function(e,t){this.radius.data("geo-location",e),t?this.radius.show():this.radius.hide()},disableItemsOutOfRange:function(t){var o=this.holder;if(o.length&&"object"==typeof t){var a,i,s=o.find(".qodef-grid-inner article"),n=o.find(".qodef-grid-inner");o.children(".qodef-out-of-range-holder").length||o.append('<div class="qodef-out-of-range-holder"></div>'),i=(a=o.children(".qodef-out-of-range-holder")).children("article"),(s.length||i.length)&&(s.each((function(){var i=e(this),s=i.data("id");if(void 0!==s&&!1!==s){var r=!1;e.each(t,(function(e,t){if(parseInt(s,10)===t)return r=!0,!0})),r||(i.appendTo(a),o.hasClass("qodef-layout--masonry")&&n.isotope("layout"))}})),i.length&&i.each((function(){var a=e(this),i=a.data("id"),s=!1;e.each(t,(function(e,t){if(parseInt(i,10)===t)return s=!0,!0})),s&&(a.appendTo(n),o.hasClass("qodef-layout--masonry")&&n.isotope("layout"))})))}}};window.qodefGeoLocation=o}(jQuery);